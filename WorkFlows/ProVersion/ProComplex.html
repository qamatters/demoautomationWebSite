<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Custom Dropdown Simulation ‚Äî Fully Functional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');
        body { font-family: 'Roboto Mono', monospace; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(-8px); } to { opacity:1; transform:translateY(0); } }
        @keyframes pulseHighlight { 0% { box-shadow:0 0 0px rgba(99,102,241,.5); } 50% { box-shadow:0 0 12px rgba(99,102,241,.7); } 100% { box-shadow:0 0 0px rgba(99,102,241,.5); } }
        .animate-fadeIn { animation: fadeIn .3s ease-out; }
        .pulse { animation: pulseHighlight 1s infinite; }
        .card { background:linear-gradient(145deg,#fff,#f0f4f8); box-shadow:0 16px 32px rgba(0,0,0,.12); border-radius:2rem; padding:2rem; backdrop-filter: blur(8px); }
        .opt:hover, .opt.active { background:#e0e7ff; font-weight:600; transform:scale(1.02); transition: all .15s ease; }
        .chev { transition: transform .25s ease; }
        .open .chev { transform: rotate(180deg); }
        .dd-menu { max-height:200px; overflow-y:auto; scroll-behavior:smooth; }
        .opt { position: relative; }
        .opt::after { content: ''; position:absolute; top:50%; right:.5rem; width:6px; height:6px; background:#6366f1; border-radius:50%; opacity:0; transform:translateY(-50%); transition:opacity .3s ease; }
        .opt.active::after { opacity:1; animation: pulseHighlight 1s infinite; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-tr from-indigo-100 via-sky-50 to-purple-100 flex items-center justify-center p-6">
<div class="card w-full max-w-2xl">
    <h1 class="text-3xl font-bold text-gray-800 text-center mb-2">üåê Advanced Dependent Dropdown Simulation</h1>
    <p class="text-sm text-gray-600 text-center mb-8">Keyboard + dynamic visual challenges ¬∑ Pulsing highlights ¬∑ Unlock delays</p>
    <div class="grid gap-6">
        <div class="dropdown relative" id="dd-country">
            <label class="block text-sm font-semibold text-gray-700 mb-1">Country</label>
            <button type="button" class="dd-btn w-full bg-white border rounded-xl px-4 py-3 flex items-center justify-between focus:outline-none focus:ring-4 focus:ring-indigo-300 shadow-md hover:shadow-lg transition-shadow">
                <span id="country-label" class="text-gray-700">Select Country</span>
                <svg class="chev h-5 w-5 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
            </button>
            <div class="dd-menu hidden absolute z-20 mt-2 w-full bg-white border rounded-xl shadow-lg animate-fadeIn" id="country-menu"></div>
        </div>
        <div class="dropdown relative" id="dd-state">
            <label class="block text-sm font-semibold text-gray-700 mb-1">State</label>
            <button type="button" class="dd-btn w-full bg-white border rounded-xl px-4 py-3 flex items-center justify-between focus:outline-none focus:ring-4 focus:ring-indigo-300 shadow-md hover:shadow-lg transition-shadow">
                <span id="state-label" class="text-gray-700">Select State</span>
                <svg class="chev h-5 w-5 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
            </button>
            <div class="dd-menu hidden absolute z-20 mt-2 w-full bg-white border rounded-xl shadow-lg animate-fadeIn" id="state-menu"></div>
            <div id="state-hint" class="text-xs text-indigo-600 mt-1 font-mono"></div>
        </div>
        <div class="dropdown relative" id="dd-city">
            <label class="block text-sm font-semibold text-gray-700 mb-1">City</label>
            <button type="button" class="dd-btn w-full bg-white border rounded-xl px-4 py-3 flex items-center justify-between focus:outline-none focus:ring-4 focus:ring-indigo-300 shadow-md hover:shadow-lg transition-shadow">
                <span id="city-label" class="text-gray-700">Select City</span>
                <svg class="chev h-5 w-5 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
            </button>
            <div class="dd-menu hidden absolute z-20 mt-2 w-full bg-white border rounded-xl shadow-lg animate-fadeIn" id="city-menu"></div>
            <div id="city-hint" class="text-xs text-indigo-600 mt-1 font-mono"></div>
        </div>
    </div>
</div>
<script>
    const DATA = { countries:["India","USA"], states:{ India:{initial:["Delhi","Maharashtra"], extra:"Karnataka (special)"}, USA:{initial:["California","Texas"], extra:null} }, cities:["Bangalore","Mysore"] };
    const qs=(s,r=document)=>r.querySelector(s);
    const qsa=(s,r=document)=>Array.from(r.querySelectorAll(s));

    const ddCountry=qs('#dd-country'), ddState=qs('#dd-state'), ddCity=qs('#dd-city');
    const countryLabel=qs('#country-label'), stateLabel=qs('#state-label'), cityLabel=qs('#city-label');
    const countryMenu=qs('#country-menu');
    const stateMenu=qs('#state-menu');
    const cityMenu=qs('#city-menu');
    const stateHint=qs('#state-hint'), cityHint=qs('#city-hint');

    function buildMenu(menu, items, onPick){
      menu.innerHTML='';
      items.forEach(it=>{
        const div=document.createElement('div');
        div.className='opt px-4 py-2 cursor-pointer';
        let value=it, label=it;
        if(typeof it==='object'){ value=it.value; label=it.label; if(it.disabled) div.classList.add('opacity-50','pointer-events-none'); }
        div.textContent=label;
        div.dataset.value=value;
        div.addEventListener('click', e=>{ e.stopPropagation(); onPick(value,label); closeAll(); });
        menu.appendChild(div);
      });
    }

    function openMenu(dd){ dd.classList.add('open'); qs('.dd-menu',dd).classList.remove('hidden'); highlightFirst(qs('.dd-menu',dd)); }
    function closeMenu(dd){ dd.classList.remove('open'); qs('.dd-menu',dd).classList.add('hidden'); clearHighlight(qs('.dd-menu',dd)); }
    function closeAll(){ qsa('.dropdown').forEach(closeMenu); }

    function randomDelay(min=1000,max=8000){ return Math.floor(Math.random()*(max-min+1))+min; }

    function highlightFirst(menu){ const first=menu.querySelector('.opt'); if(first) first.classList.add('active'); }
    function clearHighlight(menu){ qsa('.opt',menu).forEach(o=>o.classList.remove('active')); }
    function moveHighlight(menu,dir){ const opts=qsa('.opt',menu).filter(o=>!o.classList.contains('opacity-50')); const current=opts.findIndex(o=>o.classList.contains('active')); let next=dir==='down'?current+1:current-1; if(next<0)next=opts.length-1;if(next>=opts.length)next=0; opts.forEach(o=>o.classList.remove('active')); opts[next].classList.add('active'); opts[next].scrollIntoView({block:'nearest'}); }

    // Populate countries initially
    buildMenu(countryMenu,DATA.countries,(v,l)=>{ countryLabel.textContent=l; onCountrySelected(v); });
    buildMenu(stateMenu,DATA.states.India.initial,(v,l)=>{ stateLabel.textContent=l; onStateSelected(v); });
    buildMenu(cityMenu,DATA.cities,(v,l)=>{ cityLabel.textContent=l; });

    function onCountrySelected(country){ stateLabel.textContent='Select State'; cityLabel.textContent='Select City'; cityHint.textContent='';
    let states=DATA.states[country].initial.slice();
    buildMenu(stateMenu,states,(v,l)=>{ stateLabel.textContent=l; onStateSelected(v,country); });
    const extra=DATA.states[country].extra;
    if(extra){ setTimeout(()=>{ states.push(extra); buildMenu(stateMenu,states,(v,l)=>{ stateLabel.textContent=l; onStateSelected(v,country); }); stateHint.textContent='Extra state added for '+country; },1200); }}

    function onStateSelected(state){ const isSpecial=state.toLowerCase().includes('karnataka'); cityLabel.textContent='Select City'; cityHint.textContent='';
    let cities=DATA.cities.slice();
    if(isSpecial){ buildMenu(cityMenu,[ {value:'Bangalore',label:'Bangalore'}, {value:'Mysore',label:'Mysore (unlocking...)',disabled:true} ],(v,l)=>{ cityLabel.textContent=l; }); cityHint.innerHTML=`Loading extra city data <span class="loading-icon">‚è≥</span>`;
    setTimeout(()=>{ buildMenu(cityMenu,cities,(v,l)=>{ cityLabel.textContent=l; }); cityHint.textContent='City unlocked'; }, randomDelay()); } else { buildMenu(cityMenu,cities,(v,l)=>{ cityLabel.textContent=l; }); }}

    qsa('.dropdown').forEach(dd=>{
      const btn=qs('.dd-btn',dd);
      btn.addEventListener('click',e=>{ e.stopPropagation(); const isHidden=qs('.dd-menu',dd).classList.contains('hidden'); closeAll(); if(isHidden) openMenu(dd); else closeMenu(dd); });
    });
    document.addEventListener('click',closeAll);
    document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeAll();
      const openDD=qsa('.dropdown.open')[0]; if(!openDD) return; const menu=qs('.dd-menu',openDD);
      if(e.key==='ArrowDown'){ e.preventDefault(); moveHighlight(menu,'down'); }
      if(e.key==='ArrowUp'){ e.preventDefault(); moveHighlight(menu,'up'); }
      if(e.key==='Enter'){ const active=menu.querySelector('.opt.active'); if(active && !active.classList.contains('opacity-50')) active.click(); }
    });
</script>
</body>
</html>
