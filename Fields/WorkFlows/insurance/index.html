<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pro Insurance Simulation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 p-6">

  <!-- Navbar -->
  <nav class="bg-purple-600 text-white p-4 mb-6 flex justify-between items-center">
    <h1 class="text-xl font-bold">Insurance Simulation</h1>
    <ul class="flex gap-6">
      <li><a href="index.html" class="hover:underline">Home</a></li>
      <li><a href="#submit" class="hover:underline">Submit Claim</a></li>
      <li><a href="#history" class="hover:underline">Claim History</a></li>
      <li><a href="#dashboard" class="hover:underline">Dashboard</a></li>
    </ul>
  </nav>

  <!-- Claim Submission Form -->
  <section id="submit" class="bg-white p-6 rounded shadow mb-6">
    <h2 class="text-2xl font-bold mb-4">Submit a Claim</h2>
    <div class="flex flex-col md:flex-row gap-4 items-center">
      <input type="text" placeholder="Policy Number" id="policy" class="border p-2 rounded flex-1">
      <select id="claimType" class="border p-2 rounded flex-1">
        <option value="Health">Health</option>
        <option value="Vehicle">Vehicle</option>
        <option value="Life">Life</option>
      </select>
      <input type="number" placeholder="Claim Amount" id="claimAmount" class="border p-2 rounded flex-1">
      <input type="file" id="claimFile" class="border p-2 rounded flex-1" accept=".jpg,.png,.pdf">
      <span id="filePreview" class="text-gray-600"></span>
      <button class="bg-green-500 text-white px-4 py-2 rounded" onclick="submitClaim()">Submit</button>
    </div>
  </section>

  <!-- Claim History Table with Search & Pagination -->
  <section id="history" class="bg-white p-6 rounded shadow mb-6 overflow-x-auto">
    <h2 class="text-2xl font-bold mb-4">Claim History</h2>

    <!-- Filters -->
    <div class="flex flex-wrap gap-4 mb-4 items-center">
      <input type="text" id="searchBox" placeholder="Search Claims..." class="border p-2 rounded" onkeyup="renderTable()">
      <select id="filterType" class="border p-2 rounded" onchange="renderTable()">
        <option value="">All Types</option>
        <option value="Health">Health</option>
        <option value="Vehicle">Vehicle</option>
        <option value="Life">Life</option>
      </select>
      <select id="filterStatus" class="border p-2 rounded" onchange="renderTable()">
        <option value="">All Statuses</option>
        <option value="Approved">Approved</option>
        <option value="Review">Under Review</option>
        <option value="Rejected">Rejected</option>
        <option value="Settled">Settled</option>
      </select>
      <input type="date" id="startDate" class="border p-2 rounded" onchange="renderTable()">
      <input type="date" id="endDate" class="border p-2 rounded" onchange="renderTable()">
    </div>

    <table class="min-w-full border border-gray-200 text-left">
      <thead class="bg-gray-200">
        <tr>
          <th class="p-2 border">Claim ID</th>
          <th class="p-2 border">Policy No</th>
          <th class="p-2 border">Type</th>
          <th class="p-2 border">Amount</th>
          <th class="p-2 border">Status</th>
          <th class="p-2 border">Submitted</th>
          <th class="p-2 border">Action</th>
        </tr>
      </thead>
      <tbody id="claimsTable"></tbody>
    </table>

    <!-- Pagination -->
    <div class="mt-4 flex justify-between items-center">
      <button class="bg-gray-300 px-3 py-1 rounded" onclick="prevPage()">Prev</button>
      <span id="pageInfo"></span>
      <button class="bg-gray-300 px-3 py-1 rounded" onclick="nextPage()">Next</button>
    </div>
  </section>

  <!-- Dashboard Summary & Charts -->
  <section id="dashboard" class="mb-6">
    <div class="grid grid-cols-4 gap-6 mb-6">
      <div class="bg-white p-6 rounded shadow text-center">
        <h3 class="text-gray-500">Total Claims</h3>
        <p class="text-2xl font-bold" id="totalClaims">0</p>
      </div>
      <div class="bg-white p-6 rounded shadow text-center">
        <h3 class="text-gray-500">Approved</h3>
        <p class="text-2xl font-bold text-green-500" id="approvedClaims">0</p>
      </div>
      <div class="bg-white p-6 rounded shadow text-center">
        <h3 class="text-gray-500">Under Review</h3>
        <p class="text-2xl font-bold text-yellow-500" id="reviewClaims">0</p>
      </div>
      <div class="bg-white p-6 rounded shadow text-center">
        <h3 class="text-gray-500">Rejected</h3>
        <p class="text-2xl font-bold text-red-500" id="rejectedClaims">0</p>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-6">
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">Claims Over Time</h2>
        <canvas id="claimsChart"></canvas>
      </div>
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">Status Distribution</h2>
        <canvas id="statusChart"></canvas>
      </div>
    </div>
  </section>

  <script>
    // Claims Data
    let claims = [
      {id:'C001', policy:'P1001', type:'Health', amount:500, status:'Approved', date:'2025-08-01'},
      {id:'C002', policy:'P1002', type:'Vehicle', amount:1200, status:'Review', date:'2025-08-02'},
      {id:'C003', policy:'P1003', type:'Life', amount:8000, status:'Rejected', date:'2025-08-03'},
      {id:'C004', policy:'P1004', type:'Health', amount:700, status:'Review', date:'2025-08-04'},
    ];

    let currentPage = 1;
    const rowsPerPage = 3;

    // File Preview
    document.getElementById('claimFile').addEventListener('change', function(){
      const file = this.files[0];
      if(file) document.getElementById('filePreview').innerText = file.name;
    });

    function submitClaim() {
      const policy = document.getElementById('policy').value;
      const type = document.getElementById('claimType').value;
      const amount = document.getElementById('claimAmount').value;
      const file = document.getElementById('claimFile').files[0];
      if(!policy || !type || !amount || !file){ alert('Fill all fields'); return; }
      const newClaim = {
        id: `C${claims.length+1}`.padStart(4,'0'),
        policy, type, amount, status:'Review', date:new Date().toISOString().split('T')[0]
      };
      claims.push(newClaim);
      document.getElementById('policy').value='';
      document.getElementById('claimAmount').value='';
      document.getElementById('claimFile').value='';
      document.getElementById('filePreview').innerText='';
      renderTable();
      alert('Claim submitted successfully!');
    }

    // Table Render with Filters, Search & Pagination
    function renderTable(){
      const tbody = document.getElementById('claimsTable');
      const searchText = document.getElementById('searchBox').value.toLowerCase();
      const typeFilter = document.getElementById('filterType').value;
      const statusFilter = document.getElementById('filterStatus').value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;

      let filtered = claims.filter(c=>{
        return (!typeFilter || c.type===typeFilter) &&
               (!statusFilter || c.status===statusFilter) &&
               (!searchText || c.id.toLowerCase().includes(searchText) || c.policy.toLowerCase().includes(searchText)) &&
               (!startDate || c.date>=startDate) &&
               (!endDate || c.date<=endDate);
      });

      const totalPages = Math.ceil(filtered.length/rowsPerPage);
      if(currentPage>totalPages) currentPage=totalPages||1;
      const start = (currentPage-1)*rowsPerPage;
      const end = start+rowsPerPage;
      const pageData = filtered.slice(start,end);

      tbody.innerHTML='';
      pageData.forEach(c=>{
        tbody.innerHTML+=`
        <tr>
          <td class="p-2 border">${c.id}</td>
          <td class="p-2 border">${c.policy}</td>
          <td class="p-2 border">${c.type}</td>
          <td class="p-2 border">$${c.amount}</td>
          <td class="p-2 border ${c.status==='Approved'?'text-green-500':c.status==='Review'?'text-yellow-500':c.status==='Rejected'?'text-red-500':'text-gray-500'}">${c.status}</td>
          <td class="p-2 border">${c.date}</td>
          <td class="p-2 border">
            ${c.status==='Review'?`<button class="bg-blue-500 text-white px-2 py-1 rounded" onclick="approveClaim('${c.id}')">Approve</button>
            <button class="bg-red-500 text-white px-2 py-1 rounded ml-1" onclick="rejectClaim('${c.id}')">Reject</button>
            <button class="bg-gray-500 text-white px-2 py-1 rounded ml-1" onclick="settleClaim('${c.id}')">Settle</button>`:'--'}
          </td>
        </tr>`;
      });

      document.getElementById('pageInfo').innerText=`Page ${currentPage} of ${totalPages||1}`;
      updateSummary();
      updateCharts();
    }

    function approveClaim(id){ changeStatus(id,'Approved'); alert(`${id} Approved!`);}
    function rejectClaim(id){ changeStatus(id,'Rejected'); alert(`${id} Rejected!`);}
    function settleClaim(id){ changeStatus(id,'Settled'); alert(`${id} Settled!`);}
    function changeStatus(id,status){
      const claim = claims.find(c=>c.id===id);
      claim.status=status;
      renderTable();
    }

    function prevPage(){ if(currentPage>1){ currentPage--; renderTable(); } }
    function nextPage(){ currentPage++; renderTable(); }

    function updateSummary(){
      document.getElementById('totalClaims').innerText = claims.length;
      document.getElementById('approvedClaims').innerText = claims.filter(c=>c.status==='Approved').length;
      document.getElementById('reviewClaims').innerText = claims.filter(c=>c.status==='Review').length;
      document.getElementById('rejectedClaims').innerText = claims.filter(c=>c.status==='Rejected').length;
    }

    // Charts
    const claimsChartCtx = document.getElementById('claimsChart').getContext('2d');
    const statusChartCtx = document.getElementById('statusChart').getContext('2d');
    let claimsChart, statusChart;

    function updateCharts(){
      const labels = claims.map(c=>c.date);
      const data = claims.map(c=>c.amount);
      if(claimsChart) claimsChart.destroy();
      claimsChart = new Chart(claimsChartCtx, {type:'line', data:{labels, datasets:[{label:'Claim Amount', data, borderColor:'rgba(75,192,192,1)', fill:false}]}});

      const statusCounts = {
        Approved: claims.filter(c=>c.status==='Approved').length,
        Review: claims.filter(c=>c.status==='Review').length,
        Rejected: claims.filter(c=>c.status==='Rejected').length,
        Settled: claims.filter(c=>c.status==='Settled').length
      };
      if(statusChart) statusChart.destroy();
      statusChart = new Chart(statusChartCtx, {type:'pie', data:{labels:['Approved','Under Review','Rejected','Settled'], datasets:[{data:[statusCounts.Approved,statusCounts.Review,statusCounts.Rejected,statusCounts.Settled], backgroundColor:['#22c55e','#facc15','#ef4444','#9ca3af']}]}} );
    }

    renderTable();
  </script>

</body>
</html>
