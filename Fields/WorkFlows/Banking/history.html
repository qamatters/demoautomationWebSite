<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Transaction History</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans min-h-screen">

<!-- Navbar -->
<nav class="bg-purple-600 text-white p-4 flex justify-between items-center shadow-lg">
  <h1 class="text-xl font-bold">Automation Playground</h1>
  <div class="space-x-6">
    <a href="dashboard.html" class="hover:text-gray-200">Dashboard</a>
    <a href="transfer.html" class="hover:text-gray-200">Fund Transfer</a>
    <a href="history.html" class="hover:text-gray-200 underline font-semibold">Transaction History</a>
    <a href="payees.html" class="hover:text-gray-200 underline font-semibold">Payees</a>
  </div>
</nav>

<!-- History Section -->
<div class="max-w-6xl mx-auto mt-8 bg-white p-6 rounded-2xl shadow-lg">

  <h2 class="text-2xl font-semibold text-gray-700 mb-4 text-center">Transaction History</h2>

  <!-- Time Filter -->
  <label for="timeFilter" class="block text-lg font-medium mb-2">Select Period:</label>
  <select id="timeFilter" class="w-48 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 mb-6">
    <option value="3">Last 3 Months</option>
    <option value="6">Last 6 Months</option>
    <option value="12">Last 1 Year</option>
    <option value="60">Last 5 Years</option>
  </select>

  <!-- History Table -->
  <div class="overflow-x-auto">
    <table class="w-full table-auto border border-gray-200">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 border">Date & Time</th>
          <th class="px-4 py-2 border">Payee</th>
          <th class="px-4 py-2 border">Account</th>
          <th class="px-4 py-2 border">Amount</th>
          <th class="px-4 py-2 border">Description</th>
        </tr>
      </thead>
      <tbody id="historyTableBody">
        <!-- Dynamic rows go here -->
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="flex justify-between items-center mt-4">
    <button id="prevBtn" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">Prev</button>
    <span id="pageInfo" class="text-gray-700"></span>
    <button id="nextBtn" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">Next</button>
  </div>

</div>

<script>
const historyTableBody = document.getElementById('historyTableBody');
const timeFilter = document.getElementById('timeFilter');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const pageInfo = document.getElementById('pageInfo');

let currentPage = 1;
const rowsPerPage = 5; // show 5 rows per page

// ===== Dummy Data =====
const dummyTransfers = [
  {datetime:'2025-08-01T10:15:00', payee:'Raj Sharma', account:'SBIN00012345', amount:5000, description:'EMI Payment'},
  {datetime:'2025-07-28T12:30:00', payee:'Anita Verma', account:'HDFC00067890', amount:1200, description:'Gift'},
  {datetime:'2025-07-15T09:45:00', payee:'Suresh Kumar', account:'ICIC00054321', amount:2500, description:'Rent'},
  {datetime:'2025-07-10T14:20:00', payee:'Raj Sharma', account:'SBIN00012345', amount:1500, description:'Utility Bill'},
  {datetime:'2025-06-25T11:10:00', payee:'Anita Verma', account:'HDFC00067890', amount:3000, description:'Shopping'},
  {datetime:'2025-06-18T16:00:00', payee:'Suresh Kumar', account:'ICIC00054321', amount:2000, description:'EMI Payment'},
  {datetime:'2025-05-30T13:15:00', payee:'Raj Sharma', account:'SBIN00012345', amount:1000, description:'Transfer'},
  {datetime:'2025-04-20T10:05:00', payee:'Anita Verma', account:'HDFC00067890', amount:500, description:'Gift'},
  {datetime:'2025-03-10T09:00:00', payee:'Suresh Kumar', account:'ICIC00054321', amount:800, description:'Food'},
  {datetime:'2024-04-28T17:30:00', payee:'Raj Sharma', account:'SBIN00012345', amount:1200, description:'Travel'}
];

// ===== Load transfers from localStorage + dummy data =====
function getAllTransfers() {
  const stored = JSON.parse(localStorage.getItem('transfers') || '[]');
  return [...dummyTransfers, ...stored];
}

// ===== Filter transfers by months =====
function filterTransfers() {
  const months = parseInt(timeFilter.value);
  const cutoff = new Date();
  cutoff.setMonth(cutoff.getMonth() - months);

  return getAllTransfers()
    .filter(t => new Date(t.datetime) >= cutoff)
    .sort((a,b) => new Date(b.datetime) - new Date(a.datetime)); // latest first
}

// ===== Render table for current page =====
function renderTable() {
  const filtered = filterTransfers();
  const totalPages = Math.ceil(filtered.length / rowsPerPage);
  if (currentPage > totalPages) currentPage = totalPages || 1;

  const start = (currentPage - 1) * rowsPerPage;
  const end = start + rowsPerPage;
  const pageData = filtered.slice(start, end);

  historyTableBody.innerHTML = '';
  pageData.forEach(t => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td class="px-4 py-2 border">${new Date(t.datetime).toLocaleString()}</td>
      <td class="px-4 py-2 border">${t.payee}</td>
      <td class="px-4 py-2 border">${t.account}</td>
      <td class="px-4 py-2 border">â‚¹${t.amount}</td>
      <td class="px-4 py-2 border">${t.description}</td>
    `;
    historyTableBody.appendChild(row);
  });

  pageInfo.textContent = `Page ${currentPage} of ${totalPages || 1}`;
}

// ===== Event Listeners =====
timeFilter.addEventListener('change', () => { currentPage = 1; renderTable(); });
prevBtn.addEventListener('click', () => { if(currentPage>1){currentPage--; renderTable();} });
nextBtn.addEventListener('click', () => { 
  const totalPages = Math.ceil(filterTransfers().length / rowsPerPage);
  if(currentPage < totalPages){currentPage++; renderTable();} 
});

// ===== Initial Render =====
renderTable();
</script>

</body>
</html>
